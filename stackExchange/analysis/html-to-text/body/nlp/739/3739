hi
,
i
have
an
unusual
situation
in
which
i
need
a
sharepoint
timer
job
to
both
have
local
administrator
window
privilege
and
to
have
sharepoint\system
sharepoint
privilege
.
i
can
get
the
window
privilege
by
simply
configuring
the
timer
service
to
use
an
account
which
is
a
member
of
local
administrator
.
i
understand
that
this
is
not
a
good
solution
since
it
give
sharepoint
timer
service
more
right
then
it
is
supposed
to
have
.
but
it
at
least
allows
my
sharepoint
timer
job
to
run
stsadm
.
another
problem
with
running
the
timer
service
under
local
administrator
is
that
this
user
wo
n't
necessarily
have
sharepoint\system
sharepoint
privilegies
which
i
also
need
for
this
sharepoint
job
.
it
turn
out
that
spsecurity.runwithelevatedprivilegies
wo
n't
work
in
this
case
.
reflector
show
that
runwithelevatedprivilegies
check
if
the
current
process
is
owstimer
(
the
service
process
which
run
sharepoint
job
)
and
performs
no
elevation
this
is
the
case
(
the
rational
here
,
i
guess
,
is
that
the
timer
service
is
supposed
to
run
under
nt
authority\networkservice
window
account
which
which
ha
sharepoint\system
sharepoint
privilege
,
and
thus
there
's
no
need
to
elevate
privilege
for
a
timer
job
)
the
only
possible
solution
here
seems
to
be
to
run
the
timer
service
under
it
's
usual
networkserice
window
account
and
to
run
stsadm
a
a
local
administrator
by
storing
the
administrator
credential
somewhere
and
passing
them
to
system.diagnostics.process.run
(
)
trough
the
starinfo
's
username
,
domain
and
password
.
it
seems
everything
should
work
now
,
but
here
is
another
problem
i
'm
stuck
with
at
the
moment
.
stsamd
is
failing
with
the
following
error
popup
(
!
)
(
winternals
filemon
show
that
stsadm
is
running
under
the
administrator
in
this
case
)
:
the
application
failed
to
initialize
properly
(
0x0c0000142
)
.
click
ok
to
terminate
the
application
.
event
viewer
register
nothing
except
the
popup
.
the
local
administrator
user
is
my
account
and
when
i
just
run
stsadm
interactively
under
this
account
everything
is
ok
.
it
also
work
fine
when
i
configure
the
timer
service
to
run
under
this
account
.
any
suggestion
are
appreciated
:
)