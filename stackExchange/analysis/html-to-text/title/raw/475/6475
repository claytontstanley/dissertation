Faster way to find duplicates conditioned by time